const initialData = {
    comp: {
        layer0: {
            main: {
                'knob0': {
                    single: {
                        active: 'func',
                        func: {value: 'Volume mute', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    double: {
                        active: 'func',
                        func: {value: 'Layer up', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    long: {
                        active: 'func',
                        func: {value: 'Layer down', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    antiClk: {
                        active: 'func',
                        func: {value: 'Volume down', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    clkwise: {
                        active: 'func',
                        func: {value: 'Volume up', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    }
                },
                'led0': {
                    indicate: 'caps lock',
                    keycode: "if(BootKeyboard.getLeds() & LED_CAPS_LOCK) {strip.setPixelColor(0, color0);}",
                    r: 255,
                    g: 255,
                    b: 0,
                },
                'led1': {
                    indicate: 'bit1',
                    keycode: "checkBit(layer, 1, 1, color1);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'led2': {
                    indicate: 'bit0',
                    keycode: "checkBit(layer, 0, 2, color2);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'key1': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '1', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '2', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '3', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '4', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '5', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '6', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '7', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '8', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'str',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '9', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            },
            sub: {
                'knob0': {
                    single: {
                        active: 'func', 
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    double: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    long: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    antiClk: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    clkwise: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    }
                },
                'led0': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led1': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led2': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'key1': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            }
        },
        layer1: {
            main: {
                'knob0': {
                  single: {
                      active: 'func',
                      func: {value: 'Volume mute', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  double: {
                      active: 'func',
                      func: {value: 'Layer up', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  long: {
                      active: 'func',
                      func: {value: 'Layer down', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  antiClk: {
                      active: 'func',
                      func: {value: 'Volume down', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  clkwise: {
                      active: 'func',
                      func: {value: 'Volume up', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  }
                },
                'led0': {
                  indicate: 'caps lock',
                  keycode: "if(BootKeyboard.getLeds() & LED_CAPS_LOCK) {strip.setPixelColor(0, color0);}",
                  r: 255,
                  g: 255,
                  b: 0,
                },
                'led1': {
                    indicate: 'bit1',
                    keycode: "checkBit(layer, 1, 1, color1);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'led2': {
                    indicate: 'bit0',
                    keycode: "checkBit(layer, 0, 2, color2);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'key1': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            },
            sub: {
                'knob0': {
                    single: {
                        active: 'func', 
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    double: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    long: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    antiClk: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    clkwise: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    }
                },
                'led0': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led1': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led2': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'key1': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            }
        },
        layer2: {
            main: {
                'knob0': {
                  single: {
                      active: 'func',
                      func: {value: 'Volume mute', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  double: {
                      active: 'func',
                      func: {value: 'Layer up', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  long: {
                      active: 'func',
                      func: {value: 'Layer down', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  antiClk: {
                      active: 'func',
                      func: {value: 'Volume down', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  clkwise: {
                      active: 'func',
                      func: {value: 'Volume up', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  }
                },
                'led0': {
                  indicate: 'caps lock',
                  keycode: "if(BootKeyboard.getLeds() & LED_CAPS_LOCK) {strip.setPixelColor(0, color0);}",
                  r: 255,
                  g: 255,
                  b: 0,
                },
                'led1': {
                    indicate: 'bit1',
                    keycode: "checkBit(layer, 1, 1, color1);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'led2': {
                    indicate: 'bit0',
                    keycode: "checkBit(layer, 0, 2, color2);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'key1': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            },
            sub: {
                'knob0': {
                    single: {
                        active: 'func', 
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    double: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    long: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    antiClk: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    clkwise: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    }
                },
                'led0': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led1': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led2': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'key1': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            }
        },
        layer3: {
            main: {
                'knob0': {
                  single: {
                      active: 'func',
                      func: {value: 'Volume mute', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  double: {
                      active: 'func',
                      func: {value: 'Layer up', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  long: {
                      active: 'func',
                      func: {value: 'Layer down', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  antiClk: {
                      active: 'func',
                      func: {value: 'Volume down', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  },
                  clkwise: {
                      active: 'func',
                      func: {value: 'Volume up', ctrl: false, shift: false, alt: false, gui: false},
                      str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                      ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                  }
                },
                'led0': {
                  indicate: 'caps lock',
                  keycode: "if(BootKeyboard.getLeds() & LED_CAPS_LOCK) {strip.setPixelColor(0, color0);}",
                  r: 255,
                  g: 255,
                  b: 0,
                },
                'led1': {
                    indicate: 'bit1',
                    keycode: "checkBit(layer, 1, 1, color1);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'led2': {
                    indicate: 'bit0',
                    keycode: "checkBit(layer, 0, 2, color2);",
                    r: 0,
                    g: 255,
                    b: 0,
                },
                'key1': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            },
            sub: {
                'knob0': {
                    single: {
                        active: 'func', 
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    double: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    long: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    antiClk: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    },
                    clkwise: {
                        active: 'func',
                        func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                        ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    }
                },
                'led0': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led1': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'led2': {
                    indicate: '',
                    keycode: '',
                    r: 255,
                    g: 255,
                    b: 255,
                },
                'key1': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key2': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key3': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key4': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key5': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key6': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key7': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key8': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
                'key9': {
                    active: 'func',
                    func: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    str: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                    ln: {value: '', ctrl: false, shift: false, alt: false, gui: false},
                },
            }
        },
    },
    keycode: {
        'Volume up': 'Consumer.write(MEDIA_VOLUME_UP);',
        'Volume down': 'Consumer.write(MEDIA_VOLUME_DOWN);',
        'Volume mute': 'Consumer.write(MEDIA_VOLUME_MUTE);',
        'Fast forward': 'Consumer.write(MEDIA_FAST_FORWARD);',
        'Rewind': 'Consumer.write(MEDIA_REWIND);',
        'Next': 'Consumer.write(MEDIA_NEXT);',
        'Previous': 'Consumer.write(MEDIA_PREVIOUS);',
        'Stop': 'Consumer.write(MEDIA_STOP);',
        'Play/Pause': 'Consumer.write(MEDIA_PLAY_PAUSE);',
        'Email reader': 'Consumer.write(CONSUMER_EMAIL_READER);',
        'Calculator': 'Consumer.write(CONSUMER_CALCULATOR);',
        'Explorer': 'Consumer.write(CONSUMER_EXPLORER);',
        'Browser home': 'Consumer.write(CONSUMER_BROWSER_HOME);',
        'Browser back': 'Consumer.write(CONSUMER_BROWSER_BACK);',
        'Browser forward': 'Consumer.write(CONSUMER_BROWSER_FORWARD);',
        'Browser refresh': 'Consumer.write(CONSUMER_BROWSER_REFRESH);',
        'Browser bookmarks': 'Consumer.write(CONSUMER_BROWSER_BOOKMARKS);',

        'Layer up': 'layerChange(0);',
        'Layer down': 'layerChange(1);',
        'Sub-layer': 'subLayer = !subLayer;',

        'bit0': '',
        'bit1': '',
        'caps lock': '',
        'num lock': '',
        'scroll lock': '',

        'F1': 'Keyboard.press(KEY_F1);',
        'F2': 'Keyboard.press(KEY_F2);',
        'F3': 'Keyboard.press(KEY_F3);',
        'F4': 'Keyboard.press(KEY_F4);',
        'F5': 'Keyboard.press(KEY_F5);',
        'F6': 'Keyboard.press(KEY_F6);',
        'F7': 'Keyboard.press(KEY_F7);',
        'F8': 'Keyboard.press(KEY_F8);',
        'F9': 'Keyboard.press(KEY_F9);',
        'F10': 'Keyboard.press(KEY_F10);',
        'F11': 'Keyboard.press(KEY_F11);',
        'F12': 'Keyboard.press(KEY_F12);',
        'Up': 'Keyboard.press(KEY_UP_ARROW);',
        'Down': 'Keyboard.press(KEY_DOWN_ARROW);',
        'Left': 'Keyboard.press(KEY_LEFT_ARROW);',
        'Right': 'Keyboard.press(KEY_RIGHT_ARROW);',
        'Backspace': 'Keyboard.press(KEY_BACKSPACE);',
        'Tab': 'Keyboard.press(KEY_TAB);',
        'Return': 'Keyboard.press(KEY_RETURN);',
        'Esc': 'Keyboard.press(KEY_ESC);',
        'Insert': 'Keyboard.press(KEY_INSERT);',
        'Delete': 'Keyboard.press(KEY_DELETE);',
        'Page up': 'Keyboard.press(KEY_PAGE_UP);',
        'Page down': 'Keyboard.press(KEY_PAGE_DOWN);',
        'Home': 'Keyboard.press(KEY_HOME);',
        'End': 'Keyboard.press(KEY_END);',
        'Capslock': 'Keyboard.press(KEY_CAPS_LOCK);',
        'Numlock': 'Keyboard.press(KEY_NUM_LOCK);',
        'Num 1': 'Keyboard.press(KEYPAD_1);',
        'Num 2': 'Keyboard.press(KEYPAD_2);',
        'Num 3': 'Keyboard.press(KEYPAD_3);',
        'Num 4': 'Keyboard.press(KEYPAD_4);',
        'Num 5': 'Keyboard.press(KEYPAD_5);',
        'Num 6': 'Keyboard.press(KEYPAD_6);',
        'Num 7': 'Keyboard.press(KEYPAD_7);',
        'Num 8': 'Keyboard.press(KEYPAD_8);',
        'Num 9': 'Keyboard.press(KEYPAD_9);',
        'Num 0': 'Keyboard.press(KEYPAD_0);',

        "Toggle Rainbow animation": "rainbow = !rainbow;",

        '': '',
    },
    options: {
        media: [
            'Volume up',
            'Volume down',
            'Volume mute',
            'Fast forward',
            'Rewind',
            'Next',
            'Previous',
            'Stop',
            'Play/Pause',
            'Email reader',
            'Calculator',
            'Explorer',
            'Browser home',
            'Browser back',
            'Browser forward',
            'Browser refresh',
            'Browser bookmarks'
        ],
        layer: [
            'Layer up',
            'Layer down',
            'Sub-layer',
        ],
        led: [
            'bit0',
            'bit1',
            'caps lock',
            'num lock',
            'scroll lock',
        ],
        modKey: [
            'F1',
            'F2',
            'F3',
            'F4',
            'F5',
            'F6',
            'F7',
            'F8',
            'F9',
            'F10',
            'F11',
            'F12',
            'Up',
            'Down',
            'Left',
            'Right',
            'Backspace',
            'Tab',
            'Return',
            'Esc',
            'Insert',
            'Delete',
            'Page up',
            'Page down',
            'Home',
            'End',
            'Capslock',
            'Numlock',
            'Num 1',
            'Num 2',
            'Num 3',
            'Num 4',
            'Num 5',
            'Num 6',
            'Num 7',
            'Num 8',
            'Num 9',
            'Num 0',
        ],
        timeoutTab: [
          "Toggle Rainbow animation",
        ],
    },
    timeout: {
        toggled: false,
        seconds: 60,
        selected: "dimm"
    }
}
let component;
let compGroup;
let knobDetail;
let currentLayer = 'layer0';
let currentSubLayer = 'main';
let currentOption = 'media';

//check if localData exists. If not use initialData
let localData = JSON.parse(localStorage.getItem('keypadConfig'));
if(!localData) {
    localData = initialData;
}

//create layers tab and load initial option
let layerIndex = 0;
for(layer in localData.comp) {
    $('#layerTabContainer').append(`<span id="${layer}" class="layerTab ${(layerIndex==0)?'active':''}" style="${(layerIndex==0)?"border-top-left-radius: 20px;":""}">Layer ${layerIndex}</span>`);
    layerIndex++;
}
$('#layerTabContainer').append(`<span id="timeout" class="layerTab">Timeout</span>`);
loadOptions();
loadLeds();

//load options
function loadOptions() {
    $('.optionsTab.active').toggleClass('active');
    $(`#${currentOption}`).toggleClass('active');
    $('#optionContainer').empty();
    initialData.options[currentOption].forEach(option => 
        $('#optionContainer').append(`<div class="optionTile">${option}</div>`)
    );
    optionClicked();
}

//layer tab
$('.layerTab').click(function() {
    if(!$(this).hasClass('active') && $(this).attr('id')!="timeout") {
        const id = $(this).attr('id');
        $('.layerTab.active').toggleClass('active');
        $(`#${id}`).toggleClass('active');
        currentLayer = id;
        //reload leds
        loadLeds();
        $("#subLayerTabContainer").show();
        $("#name").show();
        $("#detailContainer").show();
        $("#timeoutDetail").remove();
    } else if(!$(this).hasClass('active') && $(this).attr('id')=="timeout") {
        const id = $(this).attr('id');
        $('.layerTab.active').toggleClass('active');
        $(`#${id}`).toggleClass('active');
        loadTimeoutDetails();
    }
    switch(compGroup) {
        case 'knob':
            loadKnobDetails();
            break;
        case 'led':
            loadLedDetails();
            break;
        case 'key':
            loadKeyDetails();
            break;

        default:
            break;
    }
});

//subLayer tab
$('.subLayerTab').click(function() {
    if(!$(this).hasClass('active')) {
        const id = $(this).attr('id');
        $('.subLayerTab.active').toggleClass('active');
        $(`#${id}`).toggleClass('active');
        currentSubLayer = id;
        //reload leds
        loadLeds();
    }
    switch(compGroup) {
        case 'knob':
            loadKnobDetails();
            break;
        case 'led':
            loadLedDetails();
            break;
        case 'key':
            loadKeyDetails();
            break;

        default:
            break;
    }
});

//options tab
$('.optionsTab').click(function() {
    if(!$(this).hasClass('active')) {
        const id = $(this).attr('id');
        //$('.optionsTab.active').toggleClass('active');
        //$(`#${id}`).toggleClass('active');
        currentOption = id;
    }
    checkIfTimeout();
    loadOptions();
});

//when component is selected. load details.
$('.components').click(function() {
    const id = $(this).attr('id');
    component = id;
    $('#name').html(id);
    //work out component group
    compGroup = id.slice(0,-1);
    switch(compGroup) {
        case 'knob':
            loadKnobDetails();
            //show all options
            $('#optionsTabContainer').children().each(function() {
                if($(this).attr('id') == 'led') {
                    $(this).hide();
                } else {
                    $(this).show();
                }
            });
            currentOption = 'media';
            loadOptions();
            break;
        case 'led':
            loadLedDetails();
            //hide all options other than led
            $('#optionsTabContainer').children().each(function() {
                if($(this).attr('id') != 'led') {
                    $(this).hide();
                } else {
                    $(this).show();
                }
            });
            currentOption = 'led';
            loadOptions();
            break;
        case 'key':
            loadKeyDetails();
            //show all options
            $('#optionsTabContainer').children().each(function() {
                if($(this).attr('id') == 'led') {
                    $(this).hide();
                } else {
                    $(this).show();
                }
            });
            currentOption = 'media';
            loadOptions();
            break;

        default:
            break;
    }
});

function randomID() {
  let id = "";
  let char = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
  let idLen = 6;
  for(let i=0; i<idLen; i++) {
    id += char.charAt(Math.floor(Math.random()*char.length));
  }
  return id;
}

function loadTimeoutDetails() {
    $("#subLayerTabContainer").hide();
    $("#name").hide();
    $("#detailContainer").hide();
    $("#timeoutDetail").remove();
    $("#detail").append(`<div id="timeoutDetail"></div>`);
    $("#timeoutDetail").append(`
        <div style="border-bottom: 1px var(--mainBorder) solid;">
          <h3 id="timeoutName">Timeout Options</h3>
        </div>
        <input id="toggleTimeout" value="true" class="compoundCheckbox" type="checkbox" name="toggleTimeout" ${localData.timeout.toggled?"checked":""} style="margin-top: 10px;">
        <label for="toggleTimeout">Toggle timeout after </label>
        <input type="number" id="timeoutSec" name="timeoutSec" min="1" value="${localData.timeout.seconds}">
        <label for="timeoutSec">seconds</label>
        <br>
        <input type="radio" id="dimm" class="timeoutRadio" name="timeoutType" value="dimm" ${localData.timeout.toggled?"":"disabled"} ${localData.timeout.selected=="dimm"?"checked":""}>
        <label for="dimm">Dimm LEDs</label>
        <br>
        <input type="radio" id="rainbow" class="timeoutRadio" name="timeoutType" value="rainbow" ${localData.timeout.toggled?"":"disabled"} ${localData.timeout.selected=="rainbow"?"checked":""}>
        <label for="rainbow">Rainbow</label>
    `);
    $("#timeoutSec").focus();
    let temp = $("#timeoutSec").val();
    $("#timeoutSec").val('');
    $("#timeoutSec").val(temp);
    $("#toggleTimeout").click(function() {
        let prevState = localData.timeout.toggled;
        localData.timeout.toggled = !prevState;
        saveToLocal();
        loadTimeoutDetails();
    });
    $("#timeoutSec").on("input", function(e) {
        let newVal = e.target.value;
        localData.timeout.seconds = newVal;
        saveToLocal();
        loadTimeoutDetails();
    });
    $(".timeoutRadio").click(function() {
        localData.timeout.selected = $(this).val();
        saveToLocal();
        loadTimeoutDetails();
    });
}

function checkIfTimeout() {
  if($('.layerTab.active').attr("id")=="timeout") {
    $('.layerTab.active').toggleClass("active");
    $("#layer0").toggleClass("active");
    currentLayer = "layer0";
    //reload leds
    loadLeds();
    $("#subLayerTabContainer").show();
    $("#name").show();
    $("#detailContainer").show();
    $("#timeoutDetail").remove();
  }
}

function loadLedDetails() {
    knobDetail = undefined;
    $('#detailContainer').empty();
    const indicate = localData.comp[currentLayer][currentSubLayer][component].indicate;
    const keycode = localData.comp[currentLayer][currentSubLayer][component].keycode;
    let r = localData.comp[currentLayer][currentSubLayer][component].r;
    let g = localData.comp[currentLayer][currentSubLayer][component].g;
    let b = localData.comp[currentLayer][currentSubLayer][component].b;
    const ledColor = component + 'Color';
    $('#detailContainer').append(`
        <div id="ledDetail">
        <div>Indicate: <spand id="indicate">${indicate}</spand></div>
        <button class="layerApplyBtns" id="layersIndBtn" type="button">Apply to all ${currentSubLayer} layers</button>
        <button class="layerApplyBtns" id="subLayersIndBtn" type="button">Apply to ${(currentSubLayer=='main')?"sub":"main"} layer</button>
        </div>`
    );
    $('#ledDetail').append(`<div class="wrap" style="margin: 10px 0;"><div class="colorPicker"></div></div>`);
    $('#ledDetail').append(`
        <button class="layerApplyBtns" id="layersColorBtn" type="button">Apply color to all ${currentSubLayer} layers</button>
        <button class="layerApplyBtns" id="subLayersColorBtn" type="button">Apply color to ${(currentSubLayer=='main')?"sub":"main"} layer</button>`
    );
    //create colorwheel
    let colorPicker = new iro.ColorPicker(".colorPicker", {
        width: 230,
        color: `rgb(${r}, ${g}, ${b})`,
        borderWidth: 1,
        borderColor: "#fff",
    });
    $('.wrap').append(
        `<div id="rgbValues">
            R: <input type="number" name="valueR" id="rValue" class="rgbInput" min="0" max="255" value="${r}"><br>
            G: <input type="number" name="valueG" id="gValue" class="rgbInput" min="0" max="255" value="${g}"><br>
            B: <input type="number" name="valueB" id="bValue" class="rgbInput" min="0" max="255" value="${b}">
        </div>`
    );
    //when input rgb is changed
    $(".rgbInput").on("input", function(e) {
      let newVal = Number(e.target.value);
      let color = this.id.slice(0,1);
      //localData.comp[currentLayer][currentSubLayer][component][color] = newVal;
      saveToLocal();
      switch(color) {
        case 'r':
          r = newVal;
          break;
        case 'g':
          g = newVal;
          break;
        case 'b':
          b = newVal;
          break;
        
        default:
          break;
      }
      colorPicker.color.rgbString = `rgb(${r}, ${g}, ${b})`;
    });
    //when color wheel changed
    colorPicker.on(["color:change"], function(color){
        r = color.red;
        g = color.green;
        b = color.blue;
        $("#rValue").val(r);
        $("#gValue").val(g);
        $("#bValue").val(b);
        localData.comp[currentLayer][currentSubLayer][component].r = r;
        localData.comp[currentLayer][currentSubLayer][component].g = g;
        localData.comp[currentLayer][currentSubLayer][component].b = b;
        saveToLocal();
        //edit color to led
        $(`#${ledColor}`).css('fill-opacity', 1);
        $(`#${ledColor}`).css('fill', `rgb(${r}, ${g}, ${b})`);
    });
    //when layerApplyBtns pressed
    $('.layerApplyBtns').click(function() {
        const id = $(this).attr('id');
        switch(id) {
            case 'layersIndBtn':
                for(layer in localData.comp) {
                    localData.comp[layer][currentSubLayer][component].indicate = indicate;
                    const newKeycode = createLedKeycode(indicate, layer);
                    localData.comp[layer][currentSubLayer][component].keycode = newKeycode;
                }
                break;
            case 'subLayersIndBtn':
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component].indicate = indicate;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component].keycode = keycode;
                break;
            case 'layersColorBtn':
                for(layer in localData.comp) {
                    localData.comp[layer][currentSubLayer][component].r = r;
                    localData.comp[layer][currentSubLayer][component].g = g;
                    localData.comp[layer][currentSubLayer][component].b = b;
                }
                break;
            case 'subLayersColorBtn':
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component].r = r;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component].g = g;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component].b = b;
                break;

            default:
                break;
        }
        saveToLocal();
    });
}

function loadKeyDetails() {
    knobDetail = undefined;
    $('#detailContainer').empty();
    const keyActive = localData.comp[currentLayer][currentSubLayer][component].active;
    const keyFunc = localData.comp[currentLayer][currentSubLayer][component].func.value;
    const keyStr = localData.comp[currentLayer][currentSubLayer][component].str.value;
    const keyLn = localData.comp[currentLayer][currentSubLayer][component].ln.value;

    const compoundActiveFuncCtrl = localData.comp[currentLayer][currentSubLayer][component].func.ctrl;
    const compoundActiveFuncShift = localData.comp[currentLayer][currentSubLayer][component].func.shift;
    const compoundActiveFuncAlt = localData.comp[currentLayer][currentSubLayer][component].func.alt;
    const compoundActiveFuncGui = localData.comp[currentLayer][currentSubLayer][component].func.gui;

    const compoundActiveStrCtrl = localData.comp[currentLayer][currentSubLayer][component].str.ctrl;
    const compoundActiveStrShift = localData.comp[currentLayer][currentSubLayer][component].str.shift;
    const compoundActiveStrAlt = localData.comp[currentLayer][currentSubLayer][component].str.alt;
    const compoundActiveStrGui = localData.comp[currentLayer][currentSubLayer][component].str.gui;

    const compoundActiveLnCtrl = localData.comp[currentLayer][currentSubLayer][component].ln.ctrl;
    const compoundActiveLnShift = localData.comp[currentLayer][currentSubLayer][component].ln.shift;
    const compoundActiveLnAlt = localData.comp[currentLayer][currentSubLayer][component].ln.alt;
    const compoundActiveLnGui = localData.comp[currentLayer][currentSubLayer][component].ln.gui;
    $('#detailContainer').append(
        `<div id="keyDetail">
            <input type="radio" class="detailRadio" name="${component}" id="keyFuncOption" value="func" ${(keyActive=='func')?"checked":""}>
            <label for="keyFuncOption">Function key: </label>
            <span id="funcKey">${keyFunc}</span>
            <input type="checkbox" class="compoundCheckbox func" id="ctrlFunc" name="ctrlFunc" value="ctrl" ${(compoundActiveFuncCtrl==true)?"checked":""}>
            <label for="ctrlFunc">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox func" id="shiftFunc" name="shiftFunc" value="shift" ${(compoundActiveFuncShift==true)?"checked":""}>
            <label for="shiftFunc">Shift</label>
            <input type="checkbox" class="compoundCheckbox func" id="altFunc" name="altFunc" value="alt" ${(compoundActiveFuncAlt==true)?"checked":""}>
            <label for="altFunc">Alt</label>
            <input type="checkbox" class="compoundCheckbox func" id="guiFunc" name="guiFunc" value="gui" ${(compoundActiveFuncGui==true)?"checked":""}>
            <label for="guiFunc">Gui</label><br>

            <input type="radio" class="detailRadio" name="${component}" id="keyStrOption" value="str" ${(keyActive=='str')?"checked":""}>
            <label for="keyStrOption">String: </label>
            <input type="text" class="detailInput str" value="${keyStr}">
            <input type="checkbox" class="compoundCheckbox str" id="ctrlStr" name="ctrlStr" value="ctrl" ${(compoundActiveStrCtrl==true)?"checked":""}>
            <label for="ctrlStr">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox str" id="shiftStr" name="shiftStr" value="shift" ${(compoundActiveStrShift==true)?"checked":""}>
            <label for="shiftStr">Shift</label>
            <input type="checkbox" class="compoundCheckbox str" id="altStr" name="altStr" value="alt" ${(compoundActiveStrAlt==true)?"checked":""}>
            <label for="altStr">Alt</label>
            <input type="checkbox" class="compoundCheckbox str" id="guiStr" name="guiStr" value="gui" ${(compoundActiveStrGui==true)?"checked":""}>
            <label for="guiStr">Gui</label><br>

            <input type="radio" class="detailRadio" name="${component}" id="keyLnOption" value="ln" ${(keyActive=='ln')?"checked":""}>
            <label for="keyLnOption">Line: </label>
            <input type="text" class="detailInput ln" value="${keyLn}">
            <input type="checkbox" class="compoundCheckbox ln" id="ctrlLn" name="ctrlLn" value="ctrl" ${(compoundActiveLnCtrl==true)?"checked":""}>
            <label for="ctrlLn">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox ln" id="shiftLn" name="shiftLn" value="shift" ${(compoundActiveLnShift==true)?"checked":""}>
            <label for="shiftLn">Shift</label>
            <input type="checkbox" class="compoundCheckbox ln" id="altLn" name="altLn" value="alt" ${(compoundActiveLnAlt==true)?"checked":""}>
            <label for="altLn">Alt</label>
            <input type="checkbox" class="compoundCheckbox ln" id="guiLn" name="guiLn" value="gui" ${(compoundActiveLnGui==true)?"checked":""}>
            <label for="guiLn">Gui</label><br>
            <button class="layerApplyBtns" id="layersBtn" type="button">Apply to all ${currentSubLayer} layers</button>
            <button class="layerApplyBtns" id="subLayersBtn" type="button">Apply to ${(currentSubLayer=='main')?"sub":"main"} layer</button>
        </div>`
    );
    //when input is changed
    inputEdited();
    //when radio btn changed
    radioChanged();
    //when checkbox changed
    checkboxChanged();
    //when layerApplyBtns pressed
    $('.layerApplyBtns').click(function() {
        const applyType = $(this).attr('id');
        const newActive = localData.comp[currentLayer][currentSubLayer][component].active;
        const newVal = localData.comp[currentLayer][currentSubLayer][component][newActive].value;
        const newCtrl = localData.comp[currentLayer][currentSubLayer][component][newActive].ctrl;
        const newShift = localData.comp[currentLayer][currentSubLayer][component][newActive].shift;
        const newAlt = localData.comp[currentLayer][currentSubLayer][component][newActive].alt;
        const newGui = localData.comp[currentLayer][currentSubLayer][component][newActive].gui;
        switch(applyType) {
            case 'layersBtn':
                for(layer in localData.comp) {
                    localData.comp[layer][currentSubLayer][component][newActive].value = newVal;
                    localData.comp[layer][currentSubLayer][component][newActive].ctrl = newCtrl;
                    localData.comp[layer][currentSubLayer][component][newActive].shift = newShift;
                    localData.comp[layer][currentSubLayer][component][newActive].alt = newAlt;
                    localData.comp[layer][currentSubLayer][component][newActive].gui = newGui;
                }
                break;
            case 'subLayersBtn':
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][newActive].value = newVal;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][newActive].ctrl = newCtrl;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][newActive].shift = newShift;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][newActive].alt = newAlt;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][newActive].gui = newGui;
                break;

            default:
                break;
        }
        saveToLocal();
    });
}

function loadKnobDetails() {
    knobDetail = 'single';
    $('#detailContainer').empty();
    const singleActive = localData.comp[currentLayer][currentSubLayer][component].single.active;
    const singleFunc = localData.comp[currentLayer][currentSubLayer][component].single.func.value;
    const singleStr = localData.comp[currentLayer][currentSubLayer][component].single.str.value;
    const singleLn = localData.comp[currentLayer][currentSubLayer][component].single.ln.value;
    //compound values for single
    const compoundActiveFuncCtrlSingle = localData.comp[currentLayer][currentSubLayer][component].single.func.ctrl;
    const compoundActiveFuncShiftSingle = localData.comp[currentLayer][currentSubLayer][component].single.func.shift;
    const compoundActiveFuncAltSingle = localData.comp[currentLayer][currentSubLayer][component].single.func.alt;
    const compoundActiveFuncGuiSingle = localData.comp[currentLayer][currentSubLayer][component].single.func.gui;

    const compoundActiveStrCtrlSingle = localData.comp[currentLayer][currentSubLayer][component].single.str.ctrl;
    const compoundActiveStrShiftSingle = localData.comp[currentLayer][currentSubLayer][component].single.str.shift;
    const compoundActiveStrAltSingle = localData.comp[currentLayer][currentSubLayer][component].single.str.alt;
    const compoundActiveStrGuiSingle = localData.comp[currentLayer][currentSubLayer][component].single.str.gui;

    const compoundActiveLnCtrlSingle = localData.comp[currentLayer][currentSubLayer][component].single.ln.ctrl;
    const compoundActiveLnShiftSingle = localData.comp[currentLayer][currentSubLayer][component].single.ln.shift;
    const compoundActiveLnAltSingle = localData.comp[currentLayer][currentSubLayer][component].single.ln.alt;
    const compoundActiveLnGuiSingle = localData.comp[currentLayer][currentSubLayer][component].single.ln.gui;

    const doubleActive = localData.comp[currentLayer][currentSubLayer][component].double.active;
    const doubleFunc = localData.comp[currentLayer][currentSubLayer][component].double.func.value;
    const doubleStr = localData.comp[currentLayer][currentSubLayer][component].double.str.value;
    const doubleLn = localData.comp[currentLayer][currentSubLayer][component].double.ln.value;
    //compound values for double
    const compoundActiveFuncCtrlDouble = localData.comp[currentLayer][currentSubLayer][component].double.func.ctrl;
    const compoundActiveFuncShiftDouble = localData.comp[currentLayer][currentSubLayer][component].double.func.shift;
    const compoundActiveFuncAltDouble = localData.comp[currentLayer][currentSubLayer][component].double.func.alt;
    const compoundActiveFuncGuiDouble = localData.comp[currentLayer][currentSubLayer][component].double.func.gui;

    const compoundActiveStrCtrlDouble = localData.comp[currentLayer][currentSubLayer][component].double.str.ctrl;
    const compoundActiveStrShiftDouble = localData.comp[currentLayer][currentSubLayer][component].double.str.shift;
    const compoundActiveStrAltDouble = localData.comp[currentLayer][currentSubLayer][component].double.str.alt;
    const compoundActiveStrGuiDouble = localData.comp[currentLayer][currentSubLayer][component].double.str.gui;

    const compoundActiveLnCtrlDouble = localData.comp[currentLayer][currentSubLayer][component].double.ln.ctrl;
    const compoundActiveLnShiftDouble = localData.comp[currentLayer][currentSubLayer][component].double.ln.shift;
    const compoundActiveLnAltDouble = localData.comp[currentLayer][currentSubLayer][component].double.ln.alt;
    const compoundActiveLnGuiDouble = localData.comp[currentLayer][currentSubLayer][component].double.ln.gui;

    const longActive = localData.comp[currentLayer][currentSubLayer][component].long.active;
    const longFunc = localData.comp[currentLayer][currentSubLayer][component].long.func.value;
    const longStr = localData.comp[currentLayer][currentSubLayer][component].long.str.value;
    const longLn = localData.comp[currentLayer][currentSubLayer][component].long.ln.value;
    //compound values for long
    const compoundActiveFuncCtrlLong = localData.comp[currentLayer][currentSubLayer][component].long.func.ctrl;
    const compoundActiveFuncShiftLong = localData.comp[currentLayer][currentSubLayer][component].long.func.shift;
    const compoundActiveFuncAltLong = localData.comp[currentLayer][currentSubLayer][component].long.func.alt;
    const compoundActiveFuncGuiLong = localData.comp[currentLayer][currentSubLayer][component].long.func.gui;

    const compoundActiveStrCtrlLong = localData.comp[currentLayer][currentSubLayer][component].long.str.ctrl;
    const compoundActiveStrShiftLong = localData.comp[currentLayer][currentSubLayer][component].long.str.shift;
    const compoundActiveStrAltLong = localData.comp[currentLayer][currentSubLayer][component].long.str.alt;
    const compoundActiveStrGuiLong = localData.comp[currentLayer][currentSubLayer][component].long.str.gui;

    const compoundActiveLnCtrlLong = localData.comp[currentLayer][currentSubLayer][component].long.ln.ctrl;
    const compoundActiveLnShiftLong = localData.comp[currentLayer][currentSubLayer][component].long.ln.shift;
    const compoundActiveLnAltLong = localData.comp[currentLayer][currentSubLayer][component].long.ln.alt;
    const compoundActiveLnGuiLong = localData.comp[currentLayer][currentSubLayer][component].long.ln.gui;
    
    const antiClkActive = localData.comp[currentLayer][currentSubLayer][component].antiClk.active;
    const antiClkFunc = localData.comp[currentLayer][currentSubLayer][component].antiClk.func.value;
    const antiClkStr = localData.comp[currentLayer][currentSubLayer][component].antiClk.str.value;
    const antiClkLn = localData.comp[currentLayer][currentSubLayer][component].antiClk.ln.value;
    //compound values for antiClk
    const compoundActiveFuncCtrlAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.func.ctrl;
    const compoundActiveFuncShiftAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.func.shift;
    const compoundActiveFuncAltAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.func.alt;
    const compoundActiveFuncGuiAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.func.gui;

    const compoundActiveStrCtrlAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.str.ctrl;
    const compoundActiveStrShiftAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.str.shift;
    const compoundActiveStrAltAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.str.alt;
    const compoundActiveStrGuiAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.str.gui;

    const compoundActiveLnCtrlAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.ln.ctrl;
    const compoundActiveLnShiftAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.ln.shift;
    const compoundActiveLnAltAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.ln.alt;
    const compoundActiveLnGuiAntiClk = localData.comp[currentLayer][currentSubLayer][component].antiClk.ln.gui;
    
    const clkwiseActive = localData.comp[currentLayer][currentSubLayer][component].clkwise.active;
    const clkwiseFunc = localData.comp[currentLayer][currentSubLayer][component].clkwise.func.value;
    const clkwiseStr = localData.comp[currentLayer][currentSubLayer][component].clkwise.str.value;
    const clkwiseLn = localData.comp[currentLayer][currentSubLayer][component].clkwise.ln.value;
    //compound values for clkwise
    const compoundActiveFuncCtrlClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.func.ctrl;
    const compoundActiveFuncShiftClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.func.shift;
    const compoundActiveFuncAltClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.func.alt;
    const compoundActiveFuncGuiClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.func.gui;

    const compoundActiveStrCtrlClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.str.ctrl;
    const compoundActiveStrShiftClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.str.shift;
    const compoundActiveStrAltClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.str.alt;
    const compoundActiveStrGuiClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.str.gui;

    const compoundActiveLnCtrlClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.ln.ctrl;
    const compoundActiveLnShiftClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.ln.shift;
    const compoundActiveLnAltClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.ln.alt;
    const compoundActiveLnGuiClkwise = localData.comp[currentLayer][currentSubLayer][component].clkwise.ln.gui;
    $('#detailContainer').append(
    `<div id="single" class="knobDetail ${(knobDetail=="single")?"selected":""}">
        Single click:<br>
        <input type="radio" class="detailRadio" name="single" id="singleFuncOption" value="func" ${(singleActive=='func')?"checked":""}>
        <label for="singleFuncOption">Function key: </label>
        <span id="funcSingle">${singleFunc}</span>
            <input type="checkbox" class="compoundCheckbox func" id="ctrlFuncSingle" name="ctrlFuncSingle" value="ctrl" ${(compoundActiveFuncCtrlSingle==true)?"checked":""}>
            <label for="ctrlFuncSingle">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox func" id="shiftFuncSingle" name="shiftFuncSingle" value="shift" ${(compoundActiveFuncShiftSingle==true)?"checked":""}>
            <label for="shiftFuncSingle">Shift</label>
            <input type="checkbox" class="compoundCheckbox func" id="altFuncSingle" name="altFuncSingle" value="alt" ${(compoundActiveFuncAltSingle==true)?"checked":""}>
            <label for="altFuncSingle">Alt</label>
            <input type="checkbox" class="compoundCheckbox func" id="guiFuncSingle" name="guiFuncSingle" value="gui" ${(compoundActiveFuncGuiSingle==true)?"checked":""}>
            <label for="guiFuncSingle">Gui</label><br>
        <input type="radio" class="detailRadio" name="single" id="singleStrOption" value="str" ${(singleActive=='str')?"checked":""}>
        <label for="singleStrOption">String: </label>
        <input type="text" class="detailInput str" value="${singleStr}">
            <input type="checkbox" class="compoundCheckbox str" id="ctrlStrSingle" name="ctrlStrSingle" value="ctrl" ${(compoundActiveStrCtrlSingle==true)?"checked":""}>
            <label for="ctrlStrSingle">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox str" id="shiftStrSingle" name="shiftStrSingle" value="shift" ${(compoundActiveStrShiftSingle==true)?"checked":""}>
            <label for="shiftStrSingle">Shift</label>
            <input type="checkbox" class="compoundCheckbox str" id="altStrSingle" name="altStrSingle" value="alt" ${(compoundActiveStrAltSingle==true)?"checked":""}>
            <label for="altStrSingle">Alt</label>
            <input type="checkbox" class="compoundCheckbox str" id="guiStrSingle" name="guiStrSingle" value="gui" ${(compoundActiveStrGuiSingle==true)?"checked":""}>
            <label for="guiStrSingle">Gui</label><br>
        <input type="radio" class="detailRadio" name="single" id="singleLnOption" value="ln" ${(singleActive=='ln')?"checked":""}>
        <label for="singleLnOption">Line: </label>
        <input type="text" class="detailInput ln" value="${singleLn}">
            <input type="checkbox" class="compoundCheckbox ln" id="ctrlLnSingle" name="ctrlLnSingle" value="ctrl" ${(compoundActiveLnCtrlSingle==true)?"checked":""}>
            <label for="ctrlLnSingle">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox ln" id="shiftLnSingle" name="shiftLnSingle" value="shift" ${(compoundActiveLnShiftSingle==true)?"checked":""}>
            <label for="shiftLnSingle">Shift</label>
            <input type="checkbox" class="compoundCheckbox ln" id="altLnSingle" name="altLnSingle" value="alt" ${(compoundActiveLnAltSingle==true)?"checked":""}>
            <label for="altLnSingle">Alt</label>
            <input type="checkbox" class="compoundCheckbox ln" id="guiLnSingle" name="guiLnSingle" value="gui" ${(compoundActiveLnGuiSingle==true)?"checked":""}>
            <label for="guiLnSingle">Gui</label><br>
        <button type="button" class="applyLayerBtns applyToLayers" id="singleLayers">Apply to all ${currentSubLayer} layers</button>
        <button type="button" class="applyLayerBtns applyToSub" id="singleSubLayers">Apply to ${(currentSubLayer=='main')?"sub":"main"} layer</button>
    </div>
    
    <div id="double" class="knobDetail ${(knobDetail=="double")?"selected":""}">
        Double click:<br>
        <input type="radio" class="detailRadio" name="double" id="doubleFuncOption" value="func" ${(doubleActive=='func')?"checked":""}>
        <label for="doubleFuncOption">Function key: </label>
        <span id="funcDouble">${doubleFunc}</span>
            <input type="checkbox" class="compoundCheckbox func" id="ctrlFuncDouble" name="ctrlFuncDouble" value="ctrl" ${(compoundActiveFuncCtrlDouble==true)?"checked":""}>
            <label for="ctrlFuncDouble">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox func" id="shiftFuncDouble" name="shiftFuncDouble" value="shift" ${(compoundActiveFuncShiftDouble==true)?"checked":""}>
            <label for="shiftFuncDouble">Shift</label>
            <input type="checkbox" class="compoundCheckbox func" id="altFuncDouble" name="altFuncDouble" value="alt" ${(compoundActiveFuncAltDouble==true)?"checked":""}>
            <label for="altFuncDouble">Alt</label>
            <input type="checkbox" class="compoundCheckbox func" id="guiFuncDouble" name="guiFuncDouble" value="gui" ${(compoundActiveFuncGuiDouble==true)?"checked":""}>
            <label for="guiFuncDouble">Gui</label><br>
        <input type="radio" class="detailRadio" name="double" id="doubleStrOption" value="str" ${(doubleActive=='str')?"checked":""}>
        <label for="doubleStrOption">String: </label>
        <input type="text" class="detailInput str" value="${doubleStr}">
            <input type="checkbox" class="compoundCheckbox str" id="ctrlStrDouble" name="ctrlStrDouble" value="ctrl" ${(compoundActiveStrCtrlDouble==true)?"checked":""}>
            <label for="ctrlStrDouble">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox str" id="shiftStrDouble" name="shiftStrDouble" value="shift" ${(compoundActiveStrShiftDouble==true)?"checked":""}>
            <label for="shiftStrDouble">Shift</label>
            <input type="checkbox" class="compoundCheckbox str" id="altStrDouble" name="altStrDouble" value="alt" ${(compoundActiveStrAltDouble==true)?"checked":""}>
            <label for="altStrDouble">Alt</label>
            <input type="checkbox" class="compoundCheckbox str" id="guiStrDouble" name="guiStrDouble" value="gui" ${(compoundActiveStrGuiDouble==true)?"checked":""}>
            <label for="guiStrDouble">Gui</label><br>
        <input type="radio" class="detailRadio" name="double" id="doubleLnOption" value="ln" ${(doubleActive=='ln')?"checked":""}>
        <label for="doubleLnOption">Line: </label>
        <input type="text" class="detailInput ln" value="${doubleLn}">
            <input type="checkbox" class="compoundCheckbox ln" id="ctrlLnDouble" name="ctrlLnDouble" value="ctrl" ${(compoundActiveLnCtrlDouble==true)?"checked":""}>
            <label for="ctrlLnDouble">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox ln" id="shiftLnDouble" name="shiftLnDouble" value="shift" ${(compoundActiveLnShiftDouble==true)?"checked":""}>
            <label for="shiftLnDouble">Shift</label>
            <input type="checkbox" class="compoundCheckbox ln" id="altLnDouble" name="altLnDouble" value="alt" ${(compoundActiveLnAltDouble==true)?"checked":""}>
            <label for="altLnDouble">Alt</label>
            <input type="checkbox" class="compoundCheckbox ln" id="guiLnDouble" name="guiLnDouble" value="gui" ${(compoundActiveLnGuiDouble==true)?"checked":""}>
            <label for="guiLnDouble">Gui</label><br>
        <button type="button" class="applyLayerBtns applyToLayers" id="doubleLayers">Apply to all ${currentSubLayer} layers</button>
        <button type="button" class="applyLayerBtns applyToSub" id="doubleSubLayers">Apply to ${(currentSubLayer=='main')?"sub":"main"} layer</button>    
    </div>
    
    <div id="long" class="knobDetail ${(knobDetail=="long")?"selected":""}">
        Long click:<br>
        <input type="radio" class="detailRadio" name="long" id="longFuncOption" value="func" ${(longActive=='func')?"checked":""}>
        <label for="longFuncOption">Function key: </label>
        <span id="funcLong">${longFunc}</span>
            <input type="checkbox" class="compoundCheckbox func" id="ctrlFuncLong" name="ctrlFuncLong" value="ctrl" ${(compoundActiveFuncCtrlLong==true)?"checked":""}>
            <label for="ctrlFuncLong">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox func" id="shiftFuncLong" name="shiftFuncLong" value="shift" ${(compoundActiveFuncShiftLong==true)?"checked":""}>
            <label for="shiftFuncLong">Shift</label>
            <input type="checkbox" class="compoundCheckbox func" id="altFuncLong" name="altFuncLong" value="alt" ${(compoundActiveFuncAltLong==true)?"checked":""}>
            <label for="altFuncLong">Alt</label>
            <input type="checkbox" class="compoundCheckbox func" id="guiFuncLong" name="guiFuncLong" value="gui" ${(compoundActiveFuncGuiLong==true)?"checked":""}>
            <label for="guiFuncLong">Gui</label><br>
        <input type="radio" class="detailRadio" name="long" id="longStrOption" value="str" ${(longActive=='str')?"checked":""}>
        <label for="longStrOption">String: </label>
        <input type="text" class="detailInput str" value="${longStr}">
            <input type="checkbox" class="compoundCheckbox str" id="ctrlStrLong" name="ctrlStrLong" value="ctrl" ${(compoundActiveStrCtrlLong==true)?"checked":""}>
            <label for="ctrlStrLong">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox str" id="shiftStrLong" name="shiftStrLong" value="shift" ${(compoundActiveStrShiftLong==true)?"checked":""}>
            <label for="shiftStrLong">Shift</label>
            <input type="checkbox" class="compoundCheckbox str" id="altStrLong" name="altStrLong" value="alt" ${(compoundActiveStrAltLong==true)?"checked":""}>
            <label for="altStrLong">Alt</label>
            <input type="checkbox" class="compoundCheckbox str" id="guiStrLong" name="guiStrLong" value="gui" ${(compoundActiveStrGuiLong==true)?"checked":""}>
            <label for="guiStrLong">Gui</label><br>
        <input type="radio" class="detailRadio" name="long" id="longLnOption" value="ln" ${(longActive=='ln')?"checked":""}>
        <label for="longLnOption">Line: </label>
        <input type="text" class="detailInput ln" value="${longLn}">
            <input type="checkbox" class="compoundCheckbox ln" id="ctrlLnLong" name="ctrlLnLong" value="ctrl" ${(compoundActiveLnCtrlLong==true)?"checked":""}>
            <label for="ctrlLnLong">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox ln" id="shiftLnLong" name="shiftLnLong" value="shift" ${(compoundActiveLnShiftLong==true)?"checked":""}>
            <label for="shiftLnLong">Shift</label>
            <input type="checkbox" class="compoundCheckbox ln" id="altLnLong" name="altLnLong" value="alt" ${(compoundActiveLnAltLong==true)?"checked":""}>
            <label for="altLnLong">Alt</label>
            <input type="checkbox" class="compoundCheckbox ln" id="guiLnLong" name="guiLnLong" value="gui" ${(compoundActiveLnGuiLong==true)?"checked":""}>
            <label for="guiLnLong">Gui</label><br>
        <button type="button" class="applyLayerBtns applyToLayers" id="longLayers">Apply to all ${currentSubLayer} layers</button>
        <button type="button" class="applyLayerBtns applyToSub" id="longSubLayers">Apply to ${(currentSubLayer=='main')?"sub":"main"} layer</button>    
    </div>

    <div id="antiClk" class="knobDetail ${(knobDetail=="antiClk")?"selected":""}">
        Anti-Clockwise:<br>
        <input type="radio" class="detailRadio" name="antiClk" id="antiClkFuncOption" value="func" ${(antiClkActive=='func')?"checked":""}>
        <label for="antiClkFuncOption">Function key: </label>
        <span id="funcAntiClk">${antiClkFunc}</span>
            <input type="checkbox" class="compoundCheckbox func" id="ctrlFuncAntiClk" name="ctrlFuncAntiClk" value="ctrl" ${(compoundActiveFuncCtrlAntiClk==true)?"checked":""}>
            <label for="ctrlFuncAntiClk">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox func" id="shiftFuncAntiClk" name="shiftFuncAntiClk" value="shift" ${(compoundActiveFuncShiftAntiClk==true)?"checked":""}>
            <label for="shiftFuncAntiClk">Shift</label>
            <input type="checkbox" class="compoundCheckbox func" id="altFuncAntiClk" name="altFuncAntiClk" value="alt" ${(compoundActiveFuncAltAntiClk==true)?"checked":""}>
            <label for="altFuncAntiClk">Alt</label>
            <input type="checkbox" class="compoundCheckbox func" id="guiFuncAntiClk" name="guiFuncAntiClk" value="gui" ${(compoundActiveFuncGuiAntiClk==true)?"checked":""}>
            <label for="guiFuncAntiClk">Gui</label><br>
        <input type="radio" class="detailRadio" name="antiClk" id="antiClkStrOption" value="str" ${(antiClkActive=='str')?"checked":""}>
        <label for="antiClkStrOption">String: </label>
        <input type="text" class="detailInput str" value="${antiClkStr}">
            <input type="checkbox" class="compoundCheckbox str" id="ctrlStrAntiClk" name="ctrlStrAntiClk" value="ctrl" ${(compoundActiveStrCtrlAntiClk==true)?"checked":""}>
            <label for="ctrlStrAntiClk">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox str" id="shiftStrAntiClk" name="shiftStrAntiClk" value="shift" ${(compoundActiveStrShiftAntiClk==true)?"checked":""}>
            <label for="shiftStrAntiClk">Shift</label>
            <input type="checkbox" class="compoundCheckbox str" id="altStrAntiClk" name="altStrAntiClk" value="alt" ${(compoundActiveStrAltAntiClk==true)?"checked":""}>
            <label for="altStrAntiClk">Alt</label>
            <input type="checkbox" class="compoundCheckbox str" id="guiStrAntiClk" name="guiStrAntiClk" value="gui" ${(compoundActiveStrGuiAntiClk==true)?"checked":""}>
            <label for="guiStrAntiClk">Gui</label><br>
        <input type="radio" class="detailRadio" name="antiClk" id="antiClkLnOption" value="ln" ${(antiClkActive=='ln')?"checked":""}>
        <label for="antiClkLnOption">Line: </label>
        <input type="text" class="detailInput ln" value="${antiClkLn}">
            <input type="checkbox" class="compoundCheckbox ln" id="ctrlLnAntiClk" name="ctrlLnAntiClk" value="ctrl" ${(compoundActiveLnCtrlAntiClk==true)?"checked":""}>
            <label for="ctrlLnAntiClk">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox ln" id="shiftLnAntiClk" name="shiftLnAntiClk" value="shift" ${(compoundActiveLnShiftAntiClk==true)?"checked":""}>
            <label for="shiftLnAntiClk">Shift</label>
            <input type="checkbox" class="compoundCheckbox ln" id="altLnAntiClk" name="altLnAntiClk" value="alt" ${(compoundActiveLnAltAntiClk==true)?"checked":""}>
            <label for="altLnAntiClk">Alt</label>
            <input type="checkbox" class="compoundCheckbox ln" id="guiLnAntiClk" name="guiLnAntiClk" value="gui" ${(compoundActiveLnGuiAntiClk==true)?"checked":""}>
            <label for="guiLnAntiClk">Gui</label><br>
        <button type="button" class="applyLayerBtns applyToLayers" id="antiClkLayers">Apply to all ${currentSubLayer} layers</button>
        <button type="button" class="applyLayerBtns applyToSub" id="antiClkSubLayers">Apply to ${(currentSubLayer=='main')?"sub":"main"} layer</button>    
    </div>

    <div id="clkwise" class="knobDetail ${(knobDetail=="clkwise")?"selected":""}">
        Clockwise:<br>
        <input type="radio" class="detailRadio" name="clkwise" id="clkwiseFuncOption" value="func" ${(clkwiseActive=='func')?"checked":""}>
        <label for="clkwiseFuncOption">Function key: </label>
        <span id="funcClkwise">${clkwiseFunc}</span>
            <input type="checkbox" class="compoundCheckbox func" id="ctrlFuncClkwise" name="ctrlFuncClkwise" value="ctrl" ${(compoundActiveFuncCtrlClkwise==true)?"checked":""}>
            <label for="ctrlFuncClkwise">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox func" id="shiftFuncClkwise" name="shiftFuncClkwise" value="shift" ${(compoundActiveFuncShiftClkwise==true)?"checked":""}>
            <label for="shiftFuncClkwise">Shift</label>
            <input type="checkbox" class="compoundCheckbox func" id="altFuncClkwise" name="altFuncClkwise" value="alt" ${(compoundActiveFuncAltClkwise==true)?"checked":""}>
            <label for="altFuncClkwise">Alt</label>
            <input type="checkbox" class="compoundCheckbox func" id="guiFuncClkwise" name="guiFuncClkwise" value="gui" ${(compoundActiveFuncGuiClkwise==true)?"checked":""}>
            <label for="guiFuncClkwise">Gui</label><br>
        <input type="radio" class="detailRadio" name="clkwise" id="clkwiseStrOption" value="str" ${(clkwiseActive=='str')?"checked":""}>
        <label for="clkwiseStrOption">String: </label>
        <input type="text" class="detailInput str" value="${clkwiseStr}">
            <input type="checkbox" class="compoundCheckbox str" id="ctrlStrClkwise" name="ctrlStrClkwise" value="ctrl" ${(compoundActiveStrCtrlClkwise==true)?"checked":""}>
            <label for="ctrlStrClkwise">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox str" id="shiftStrClkwise" name="shiftStrClkwise" value="shift" ${(compoundActiveStrShiftClkwise==true)?"checked":""}>
            <label for="shiftStrClkwise">Shift</label>
            <input type="checkbox" class="compoundCheckbox str" id="altStrClkwise" name="altStrClkwise" value="alt" ${(compoundActiveStrAltClkwise==true)?"checked":""}>
            <label for="altStrClkwise">Alt</label>
            <input type="checkbox" class="compoundCheckbox str" id="guiStrClkwise" name="guiStrClkwise" value="gui" ${(compoundActiveStrGuiClkwise==true)?"checked":""}>
            <label for="guiStrClkwise">Gui</label><br>
        <input type="radio" class="detailRadio" name="clkwise" id="clkwiseLnOption" value="ln" ${(clkwiseActive=='ln')?"checked":""}>
        <label for="clkwiseLnOption">Line: </label>
        <input type="text" class="detailInput ln" value="${clkwiseLn}">
            <input type="checkbox" class="compoundCheckbox ln" id="ctrlLnClkwise" name="ctrlLnClkwise" value="ctrl" ${(compoundActiveLnCtrlClkwise==true)?"checked":""}>
            <label for="ctrlLnClkwise">Ctrl</label>
            <input type="checkbox" class="compoundCheckbox ln" id="shiftLnClkwise" name="shiftLnClkwise" value="shift" ${(compoundActiveLnShiftClkwise==true)?"checked":""}>
            <label for="shiftLnClkwise">Shift</label>
            <input type="checkbox" class="compoundCheckbox ln" id="altLnClkwise" name="altLnClkwise" value="alt" ${(compoundActiveLnAltClkwise==true)?"checked":""}>
            <label for="altLnClkwise">Alt</label>
            <input type="checkbox" class="compoundCheckbox ln" id="guiLnClkwise" name="guiLnClkwise" value="gui" ${(compoundActiveLnGuiClkwise==true)?"checked":""}>
            <label for="guiLnClkwise">Gui</label><br>
        <button type="button" class="applyLayerBtns applyToLayers" id="clkwiseLayers">Apply to all ${currentSubLayer} layers</button>
        <button type="button" class="applyLayerBtns applyToSub" id="clkwiseSubLayers">Apply to ${(currentSubLayer=='main')?"sub":"main"} layer</button>
    </div>`
    );
    //when input area is changed
    inputEdited();
    //when radio btns changed
    radioChanged();
    //when checkbox changed
    checkboxChanged();
    //to select between single, double etc.
    $('.knobDetail').on("mousedown", function() {
        knobDetail = $(this).attr('id');
        $('.knobDetail.selected').toggleClass('selected');
        $(`#${knobDetail}`).toggleClass('selected');
    });
    //when applyLayerBtns is pressed
    $('.applyLayerBtns').click(function() {
        const applyType = this.classList[1];
        const newActive = localData.comp[currentLayer][currentSubLayer][component][knobDetail].active;
        const newVal = localData.comp[currentLayer][currentSubLayer][component][knobDetail][newActive].value;
        const newCtrlVal = localData.comp[currentLayer][currentSubLayer][component][knobDetail][newActive].ctrl;
        const newShiftVal = localData.comp[currentLayer][currentSubLayer][component][knobDetail][newActive].shift;
        const newAltVal = localData.comp[currentLayer][currentSubLayer][component][knobDetail][newActive].alt;
        const newGuiVal = localData.comp[currentLayer][currentSubLayer][component][knobDetail][newActive].gui;
        switch(applyType) {
            case 'applyToLayers':
                for(layer in localData.comp) {
                    localData.comp[layer][currentSubLayer][component][knobDetail][newActive].value = newVal;
                    localData.comp[layer][currentSubLayer][component][knobDetail][newActive].ctrl = newCtrlVal;
                    localData.comp[layer][currentSubLayer][component][knobDetail][newActive].shift = newShiftVal;
                    localData.comp[layer][currentSubLayer][component][knobDetail][newActive].alt = newAltVal;
                    localData.comp[layer][currentSubLayer][component][knobDetail][newActive].gui = newGuiVal;
                }
                break;
            case 'applyToSub':
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][knobDetail][newActive].value = newVal;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][knobDetail][newActive].ctrl = newCtrlVal;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][knobDetail][newActive].shift = newShiftVal;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][knobDetail][newActive].alt = newAltVal;
                localData.comp[currentLayer][(currentSubLayer=='main')?"sub":"main"][component][knobDetail][newActive].gui = newGuiVal;
                break;
            
            default:
                break;
        }
        saveToLocal();
    });
}

//when option is clicked
function optionClicked() {
  $('.optionTile').click(function() {
    checkIfTimeout();
    const func = $(this).text();
    if(component) {
      switch(compGroup) {
        case 'led':
          const keycode = createLedKeycode(func, currentLayer);
          localData.comp[currentLayer][currentSubLayer][component].indicate = func;
          localData.comp[currentLayer][currentSubLayer][component].keycode = keycode;
          loadLedDetails();
          break;
        case 'key':
          localData.comp[currentLayer][currentSubLayer][component].func.value = func;
          loadKeyDetails();
          break;
        case 'knob':
          localData.comp[currentLayer][currentSubLayer][component][knobDetail].func.value = func;
          loadKnobDetails();
          break;
        
        default:
          break;
      }
      saveToLocal();
    }
  });
}

function createLedKeycode(func, layer) {
    const ledIndex = component.slice(-1);
    const layerIndex = layer.slice(-1);
    let keycode;
    switch(func) {
        case 'bit0':
            keycode = `checkBit(layer, 0, ${ledIndex}, color${ledIndex});`;
            break;
        case 'bit1':
            keycode = `checkBit(layer, 1, ${ledIndex}, color${ledIndex});`;
            break;
        case 'caps lock':
            keycode = `if(BootKeyboard.getLeds() & LED_CAPS_LOCK) {strip.setPixelColor(${ledIndex}, color${ledIndex});}`;
            break;
        case 'num lock':
            keycode = `if(BootKeyboard.getLeds() & LED_NUM_LOCK) {strip.setPixelColor(${ledIndex}, color${ledIndex});}`;
            break;
        case 'scroll lock':
            keycode = `if(BootKeyboard.getLeds() & LED_SCROLL_LOCK) {strip.setPixelColor(${ledIndex}, color${ledIndex});}`;
            break;

        default:
            break;
    }
    return keycode;
}

//when detailInput is edited
function inputEdited() {
    $('.detailInput').on("input", function(e) {
        const inputType = this.classList[1];
        const newVal = e.target.value;
        if(!knobDetail) {   //for key
            localData.comp[currentLayer][currentSubLayer][component][inputType].value = newVal;
        } else {    //for knob
            localData.comp[currentLayer][currentSubLayer][component][knobDetail][inputType].value = newVal;
        }
        saveToLocal();
    });
}

//when radio btn are changed
function radioChanged() {
    $('.detailRadio').click(function() {
        const type = $(this).val();
        const detail = $(this).attr('name');
        if(detail != component) {     //for knob
            localData.comp[currentLayer][currentSubLayer][component][detail].active = type;
        } else {    //for key
            localData.comp[currentLayer][currentSubLayer][component].active = type;
        }
        saveToLocal();
    });
}

//when checkbox are changed
function checkboxChanged() {
    $('.compoundCheckbox').click(function() {
        const compound = $(this).val();
        const type = this.classList[1];
        if(knobDetail) {    //if knob is selected
            prevState = localData.comp[currentLayer][currentSubLayer][component][knobDetail][type][compound];
            localData.comp[currentLayer][currentSubLayer][component][knobDetail][type][compound] = !prevState;
        } else {    //for key
            prevState = localData.comp[currentLayer][currentSubLayer][component][type][compound];
            prevState = localData.comp[currentLayer][currentSubLayer][component][type][compound] = !prevState;
        }
        saveToLocal();
    });
}

//load led colors
function loadLeds() {
    const r0 = localData.comp[currentLayer][currentSubLayer].led0.r;
    const g0 = localData.comp[currentLayer][currentSubLayer].led0.g;
    const b0 = localData.comp[currentLayer][currentSubLayer].led0.b;
    $('#led0Color').css('fill-opacity', 1);
    $('#led0Color').css('fill', `rgb(${r0}, ${g0}, ${b0})`);
    const r1 = localData.comp[currentLayer][currentSubLayer].led1.r;
    const g1 = localData.comp[currentLayer][currentSubLayer].led1.g;
    const b1 = localData.comp[currentLayer][currentSubLayer].led1.b;
    $('#led1Color').css('fill-opacity', 1);
    $('#led1Color').css('fill', `rgb(${r1}, ${g1}, ${b1})`);
    const r2 = localData.comp[currentLayer][currentSubLayer].led2.r;
    const g2 = localData.comp[currentLayer][currentSubLayer].led2.g;
    const b2 = localData.comp[currentLayer][currentSubLayer].led2.b;
    $('#led2Color').css('fill-opacity', 1);
    $('#led2Color').css('fill', `rgb(${r2}, ${g2}, ${b2})`);
}

//save to localStorage
function saveToLocal() {
    localStorage.setItem('keypadConfig', JSON.stringify(localData));
}

//download file
$('.file').click(function() {
    const type = $(this).attr('id');
    switch(type) {
        case 'downloadJSON':
            const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(localData));
            $('body').append(`<a id="downloadAnchor" href="${dataStr}" download="keypad.json"></a>`);
            document.getElementById('downloadAnchor').click();
            $('#downloadAnchor').remove();
            break;
        case 'downloadIno':
            const ino = 'data:text/json;charset=utf-8,' + encodeURIComponent(createIno());
            $('body').append(`<a id="downloadAnchor" href="${ino}" download="keypad_${randomID()}.ino"></a>`);
            document.getElementById('downloadAnchor').click();
            $('#downloadAnchor').remove();
            break;

        default:
            break;
    }
});

//upload json file
$('#uploadJSON').change(function(e) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const fileContent = JSON.parse(e.target.result);
        localData = fileContent;
        switch(component.slice(0,-1)) {
            case 'led':
                loadLedDetails();
                break;
            case 'key':
                loadKeyDetails();
                break;
            case 'knob':
                loadKnobDetails();
                break;

            default:
                break;
        }
        saveToLocal();
    }
    reader.readAsText(e.target.files[0]);
});

function createKeyKeycode(layer, sublayer, key) {
    const ctrl = 'Keyboard.press(KEY_LEFT_CTRL);';
    const shift = 'Keyboard.press(KEY_LEFT_SHIFT);';
    const alt = 'Keyboard.press(KEY_LEFT_ALT);';
    const gui = 'Keyboard.press(KEY_LEFT_GUI);';
    const active = localData.comp[layer][sublayer][key].active;
    let keycode = '';
    switch(active) {
        case 'func':
            if(localData.comp[layer][sublayer][key].func.ctrl){keycode+=ctrl};
            if(localData.comp[layer][sublayer][key].func.shift){keycode+=shift};
            if(localData.comp[layer][sublayer][key].func.alt){keycode+=alt};
            if(localData.comp[layer][sublayer][key].func.gui){keycode+=gui};
            keycode += localData.keycode[localData.comp[layer][sublayer][key].func.value];
            break;
        case 'str':
            if(localData.comp[layer][sublayer][key].str.ctrl){keycode+=ctrl};
            if(localData.comp[layer][sublayer][key].str.shift){keycode+=shift};
            if(localData.comp[layer][sublayer][key].str.alt){keycode+=alt};
            if(localData.comp[layer][sublayer][key].str.gui){keycode+=gui};
            keycode += `Keyboard.print("${localData.comp[layer][sublayer][key].str.value}");`;
            break;
        case 'ln':
            if(localData.comp[layer][sublayer][key].ln.ctrl){keycode+=ctrl};
            if(localData.comp[layer][sublayer][key].ln.shift){keycode+=shift};
            if(localData.comp[layer][sublayer][key].ln.alt){keycode+=alt};
            if(localData.comp[layer][sublayer][key].ln.gui){keycode+=gui};
            keycode += `Keyboard.println("${localData.comp[layer][sublayer][key].ln.value}");`;
            break;
        
        default:
            break;
    }
    return(keycode);
}

function createKnobKeycode(layer, sublayer, actionType) {
    const ctrl = 'Keyboard.press(KEY_LEFT_CTRL);';
    const shift = 'Keyboard.press(KEY_LEFT_SHIFT);';
    const alt = 'Keyboard.press(KEY_LEFT_ALT);';
    const gui = 'Keyboard.press(KEY_LEFT_GUI);';
    const active = localData.comp[layer][sublayer].knob0[actionType].active;
    let keycode = '';
    switch(active) {
        case 'func':
            if(localData.comp[layer][sublayer].knob0[actionType].func.ctrl){keycode+=ctrl};
            if(localData.comp[layer][sublayer].knob0[actionType].func.shift){keycode+=shift};
            if(localData.comp[layer][sublayer].knob0[actionType].func.alt){keycode+=alt};
            if(localData.comp[layer][sublayer].knob0[actionType].func.gui){keycode+=gui};
            keycode += localData.keycode[localData.comp[layer][sublayer].knob0[actionType].func.value];
            break;
        case 'str':
            if(localData.comp[layer][sublayer].knob0[actionType].str.ctrl){keycode+=ctrl};
            if(localData.comp[layer][sublayer].knob0[actionType].str.shift){keycode+=shift};
            if(localData.comp[layer][sublayer].knob0[actionType].str.alt){keycode+=alt};
            if(localData.comp[layer][sublayer].knob0[actionType].str.gui){keycode+=gui};
            keycode += `Keyboard.print("${localData.comp[layer][sublayer].knob0[actionType].str.value}");`;
            break;
        case 'ln':
            if(localData.comp[layer][sublayer].knob0[actionType].ln.ctrl){keycode+=ctrl};
            if(localData.comp[layer][sublayer].knob0[actionType].ln.shift){keycode+=shift};
            if(localData.comp[layer][sublayer].knob0[actionType].ln.alt){keycode+=alt};
            if(localData.comp[layer][sublayer].knob0[actionType].ln.gui){keycode+=gui};
            keycode += `Keyboard.println("${localData.comp[layer][sublayer].knob0[actionType].ln.value}");`;
            break;

        default:
            break;
    }
    return keycode;
}

//create ino file
function createIno() {
    return (
`#include <HID-Project.h>
#include <Adafruit_NeoPixel.h>

#define ledStripPin A3
#define ledCount 3
#define outputA A2
#define outputB A0
#define encoderBtn 15

const unsigned long timeout = ${localData.timeout.seconds*1000};
unsigned long idleTime;
bool idleStart = false;
bool idle = false;
bool rainbow = ${localData.timeout.selected=="rainbow"?"true":"false"};
bool timeoutEnabled = ${localData.timeout.toggled};
const int rowNum = 3;
const int colNum = 3;
byte rowPins[rowNum] = {10, 9, 7};
byte colPins[colNum] = {8, 14, 16};
int layer = 0;
bool subLayer = false;
const int pulseDebounce = 0;
unsigned long lastPulse = 0;

Adafruit_NeoPixel strip(ledCount, ledStripPin, NEO_GRB + NEO_KHZ800);

int getKey();
void layerChange(byte sign);
void checkBit(byte layer, byte bit, byte led, uint32_t rgb);
uint8_t tableDecode();
uint8_t getClick();

void setup() {
  Serial.begin(9600);
  strip.begin();
  strip.show();
  for(byte c=0; c<colNum; c++) {
    pinMode(colPins[c], INPUT_PULLUP);
  }
  pinMode(outputA, INPUT_PULLUP);
  pinMode(outputB, INPUT_PULLUP);
  pinMode(encoderBtn, INPUT_PULLUP);
  Consumer.begin();
  Keyboard.begin();
  BootKeyboard.begin();
  Mouse.begin();
}

void loop() {
  bool noInput = true;
  if(!idle) strip.setBrightness(12);

  switch(layer) {
    //layer 0
    case 0:
      if(subLayer) {
        //sublayer 0
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer0.sub.led0.r}, ${localData.comp.layer0.sub.led0.g}, ${localData.comp.layer0.sub.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer0.sub.led1.r}, ${localData.comp.layer0.sub.led1.g}, ${localData.comp.layer0.sub.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer0.sub.led2.r}, ${localData.comp.layer0.sub.led2.g}, ${localData.comp.layer0.sub.led2.b});
        ${localData.comp.layer0.sub.led0.keycode}
        ${localData.comp.layer0.sub.led1.keycode}
        ${localData.comp.layer0.sub.led2.keycode}
      } else {
        //mainlayer 0
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer0.main.led0.r}, ${localData.comp.layer0.main.led0.g}, ${localData.comp.layer0.main.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer0.main.led1.r}, ${localData.comp.layer0.main.led1.g}, ${localData.comp.layer0.main.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer0.main.led2.r}, ${localData.comp.layer0.main.led2.g}, ${localData.comp.layer0.main.led2.b});
        ${localData.comp.layer0.main.led0.keycode}
        ${localData.comp.layer0.main.led1.keycode}
        ${localData.comp.layer0.main.led2.keycode}
      }
      break;
    //layer 1
    case 1:
      if(subLayer){
        //sublayer 1
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer1.sub.led0.r}, ${localData.comp.layer1.sub.led0.g}, ${localData.comp.layer1.sub.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer1.sub.led1.r}, ${localData.comp.layer1.sub.led1.g}, ${localData.comp.layer1.sub.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer1.sub.led2.r}, ${localData.comp.layer1.sub.led2.g}, ${localData.comp.layer1.sub.led2.b});
        ${localData.comp.layer1.sub.led0.keycode}
        ${localData.comp.layer1.sub.led1.keycode}
        ${localData.comp.layer1.sub.led2.keycode}
      } else {
        //mainlayer 1
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer1.main.led0.r}, ${localData.comp.layer1.main.led0.g}, ${localData.comp.layer1.main.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer1.main.led1.r}, ${localData.comp.layer1.main.led1.g}, ${localData.comp.layer1.main.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer1.main.led2.r}, ${localData.comp.layer1.main.led2.g}, ${localData.comp.layer1.main.led2.b});
        ${localData.comp.layer1.main.led0.keycode}
        ${localData.comp.layer1.main.led1.keycode}
        ${localData.comp.layer1.main.led2.keycode}
      }
      break;
    //layer 2
    case 2:
      if(subLayer){
        //sublayer 2
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer2.sub.led0.r}, ${localData.comp.layer2.sub.led0.g}, ${localData.comp.layer2.sub.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer2.sub.led1.r}, ${localData.comp.layer2.sub.led1.g}, ${localData.comp.layer2.sub.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer2.sub.led2.r}, ${localData.comp.layer2.sub.led2.g}, ${localData.comp.layer2.sub.led2.b});
        ${localData.comp.layer2.sub.led0.keycode}
        ${localData.comp.layer2.sub.led1.keycode}
        ${localData.comp.layer2.sub.led2.keycode}
      } else {
        //mainlayer 2
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer2.main.led0.r}, ${localData.comp.layer2.main.led0.g}, ${localData.comp.layer2.main.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer2.main.led1.r}, ${localData.comp.layer2.main.led1.g}, ${localData.comp.layer2.main.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer2.main.led2.r}, ${localData.comp.layer2.main.led2.g}, ${localData.comp.layer2.main.led2.b});
        ${localData.comp.layer2.main.led0.keycode}
        ${localData.comp.layer2.main.led1.keycode}
        ${localData.comp.layer2.main.led2.keycode}
      }
      break;
    //layer 3
    case 3:
      if(subLayer){
        //sublayer 3
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer3.sub.led0.r}, ${localData.comp.layer3.sub.led0.g}, ${localData.comp.layer3.sub.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer3.sub.led1.r}, ${localData.comp.layer3.sub.led1.g}, ${localData.comp.layer3.sub.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer3.sub.led2.r}, ${localData.comp.layer3.sub.led2.g}, ${localData.comp.layer3.sub.led2.b});
        ${localData.comp.layer3.sub.led0.keycode}
        ${localData.comp.layer3.sub.led1.keycode}
        ${localData.comp.layer3.sub.led2.keycode}
      } else {
        //mainlayer 3
        strip.clear();
        uint32_t color0 = strip.Color(${localData.comp.layer3.main.led0.r}, ${localData.comp.layer3.main.led0.g}, ${localData.comp.layer3.main.led0.b});
        uint32_t color1 = strip.Color(${localData.comp.layer3.main.led1.r}, ${localData.comp.layer3.main.led1.g}, ${localData.comp.layer3.main.led1.b});
        uint32_t color2 = strip.Color(${localData.comp.layer3.main.led2.r}, ${localData.comp.layer3.main.led2.g}, ${localData.comp.layer3.main.led2.b});
        ${localData.comp.layer3.main.led0.keycode}
        ${localData.comp.layer3.main.led1.keycode}
        ${localData.comp.layer3.main.led2.keycode}
      }
      break;
      
    default:
      break;
  }
  
  uint8_t clickType = getClick();
  uint8_t direction = tableDecode();
  uint8_t key = getKey();
  if(key || direction || clickType) noInput = false, idleStart = true, idle = false;

  switch (layer) {
    //layer 0
    case 0:
      if(key){
        switch (key) {
          case 1:
            if(subLayer) {
              //sublayer 0 key 1
              ${createKeyKeycode('layer0', 'sub', 'key1')}
            } else {
              //mainlayer 0 key 1
              ${createKeyKeycode('layer0', 'main', 'key1')}
            }
            break;
          case 2:
            if(subLayer) {
              //sublayer 0 key 2
              ${createKeyKeycode('layer0', 'sub', 'key2')}
            } else {
              //mainlayer 0 key 2
              ${createKeyKeycode('layer0', 'main', 'key2')}
            }
            break;
          case 3:
            if(subLayer) {
              //sublayer 0 key 3
              ${createKeyKeycode('layer0', 'sub', 'key3')}
            } else {
              //mainlayer 0 key 3
              ${createKeyKeycode('layer0', 'main', 'key3')}
            }
            break;
          case 4:
            if(subLayer) {
              //sublayer 0 key 4
              ${createKeyKeycode('layer0', 'sub', 'key4')}
            } else {
              //mainlayer 0 key 4
              ${createKeyKeycode('layer0', 'main', 'key4')}
            }
            break;
          case 5:
            if(subLayer) {
              //sublayer 0 key 5
              ${createKeyKeycode('layer0', 'sub', 'key5')}
            } else {
              //mainlayer 0 key 5
              ${createKeyKeycode('layer0', 'main', 'key5')}
            }
            break;
          case 6:
            if(subLayer) {
              //sublayer 0 key 6
              ${createKeyKeycode('layer0', 'sub', 'key6')}
            } else {
              //mainlayer 0 key 6
              ${createKeyKeycode('layer0', 'main', 'key6')}
            }
            break;
          case 7:
            if(subLayer) {
              //sublayer 0 key 7
              ${createKeyKeycode('layer0', 'sub', 'key7')}
            } else {
              //mainlayer 0 key 7
              ${createKeyKeycode('layer0', 'main', 'key7')}
            }
            break;
          case 8:
            if(subLayer) {
              //sublayer 0 key 8
              ${createKeyKeycode('layer0', 'sub', 'key8')}
            } else {
              //mainlayer 0 key 8
              ${createKeyKeycode('layer0', 'main', 'key8')}
            }
            break;
          case 9:
            if(subLayer) {
              //sublayer 0 key 9
              ${createKeyKeycode('layer0', 'sub', 'key9')}
            } else {
              //mainlayer 0 key 9
              ${createKeyKeycode('layer0', 'main', 'key9')}
            }
            break;

          default:
            break;
        }
        Keyboard.releaseAll();
      }
      
      if(clickType) {
        switch(clickType) {
          case 1: //single
            if(subLayer) {
              //sublayer 0 single
              ${createKnobKeycode('layer0', 'sub', 'single')}
            } else {
              //mainlayer 0 single
              ${createKnobKeycode('layer0', 'main', 'single')}
            }
            break;
          case 2: //double
            if(subLayer) {
              //sublayer 0 double
              ${createKnobKeycode('layer0', 'sub', 'double')}
            } else {
              //mainlayer 0 double
              ${createKnobKeycode('layer0', 'main', 'double')}
            }
            break;
          case 3: //long
            if(subLayer) {
              //sublayer 0 long
              ${createKnobKeycode('layer0', 'sub', 'long')}
            } else {
              //mainlayer 0 long
              ${createKnobKeycode('layer0', 'main', 'long')}
            }
            break;

          default:
            break;
        }
        clickType = 0;
      }
      if(direction) {
        switch (direction) {
          case 1:     //clockwise
            if(subLayer) {
              //sublayer 0 cw
              ${createKnobKeycode('layer0', 'sub', 'clkwise')}
            } else {
              //mainlayer 0 cw
              ${createKnobKeycode('layer0', 'main', 'clkwise')}
            }
            break;
          case 2:     //anti-clockwise
            if(subLayer) {
              //sublayer 0 ccw
              ${createKnobKeycode('layer0', 'sub', 'antiClk')}
            } else {
              //mainlayer 0 ccw
              ${createKnobKeycode('layer0', 'main', 'antiClk')}
            }
            break;

          default:
            break;
        }
      }
      Keyboard.releaseAll();
      break;
      
    //layer 1
    case 1:
      if(key){
        switch (key) {
          case 1:
            if(subLayer) {
              //sublayer 1 key 1
              ${createKeyKeycode('layer1', 'sub', 'key1')}
            } else {
              //mainlayer 1 key 1
              ${createKeyKeycode('layer1', 'main', 'key1')}
            }
            break;
          case 2:
            if(subLayer) {
              //sublayer 1 key 2
              ${createKeyKeycode('layer1', 'sub', 'key2')}
            } else {
              //mainlayer 1 key 2
              ${createKeyKeycode('layer1', 'main', 'key2')}
            }
            break;
          case 3:
            if(subLayer) {
              //sublayer 1 key 3
              ${createKeyKeycode('layer1', 'sub', 'key3')}
            } else {
              //mainlayer 1 key 3
              ${createKeyKeycode('layer1', 'main', 'key3')}
            }
            break;
          case 4:
            if(subLayer) {
              //sublayer 1 key 4
              ${createKeyKeycode('layer1', 'sub', 'key4')} 
            } else {
              //mainlayer 1 key 4
              ${createKeyKeycode('layer1', 'main', 'key4')}
            }
            break;
          case 5:
            if(subLayer) {
              //sublayer 1 key 5
              ${createKeyKeycode('layer1', 'sub', 'key5')}
            } else {
              //mainlayer 1 key 5
              ${createKeyKeycode('layer1', 'main', 'key5')}
            }
            break;
          case 6:
            if(subLayer) {
              //sublayer 1 key 6
              ${createKeyKeycode('layer1', 'sub', 'key6')}
            } else {
              //mainlayer 1 key 6
              ${createKeyKeycode('layer1', 'main', 'key6')}
            }
            break;
          case 7:
            if(subLayer) {
              //sublayer 1 key 7
              ${createKeyKeycode('layer1', 'sub', 'key7')}
            } else {
              //mainlayer 1 key 7
              ${createKeyKeycode('layer1', 'main', 'key7')}
            }
            break;
          case 8:
            if(subLayer) {
              //sublayer 1 key 8
              ${createKeyKeycode('layer1', 'sub', 'key8')}
            } else {
              //mainlayer 1 key 8
              ${createKeyKeycode('layer1', 'main', 'key8')}
            }
            break;
          case 9:
            if(subLayer) {
              //sublayer 1 key 9
              ${createKeyKeycode('layer1', 'sub', 'key9')}
            } else {
              //mainlayer 1 key 9
              ${createKeyKeycode('layer1', 'main', 'key9')}
            }
            break;

          default:
            break;
        }
        Keyboard.releaseAll();
      }
      
      if(clickType) {
        switch(clickType) {
          case 1: //single
            if(subLayer) {
              //sublayer 1 single
              ${createKnobKeycode('layer1', 'sub', 'single')}
            } else {
              //mainlayer 1 single
              ${createKnobKeycode('layer1', 'main', 'single')}
            }
            break;
          case 2: //double
            if(subLayer) {
              //sublayer 1 double
              ${createKnobKeycode('layer1', 'sub', 'double')}
            } else {
              //mainlayer 1 double
              ${createKnobKeycode('layer1', 'main', 'double')}
            }
            break;
          case 3: //long
            if(subLayer) {
              //sublayer 1 long
              ${createKnobKeycode('layer1', 'sub', 'long')}
            } else {
              //mainlayer 1 long
              ${createKnobKeycode('layer1', 'main', 'long')}
            }
            break;

          default:
            break;
        }
        clickType = 0;
      }
      if(direction) {
        switch (direction) {
          case 1:     //clockwise
            if(subLayer) {
              //sublayer 1 cw
              ${createKnobKeycode('layer1', 'sub', 'clkwise')}
            } else {
              //mainlayer 1 cw
              ${createKnobKeycode('layer1', 'main', 'clkwise')}
            }
            break;
          case 2:     //anti-clockwise
            if(subLayer) {
              //sublayer 1 ccw
              ${createKnobKeycode('layer1', 'sub', 'antiClk')}
            } else {
              //mainlayer 1 ccw
              ${createKnobKeycode('layer1', 'main', 'antiClk')}
            }
            break;

          default:
            break;
        }
      }
      Keyboard.releaseAll();  
      break;

    //layer 2
    case 2:
      if(key){
        switch (key) {
          case 1:
            if(subLayer) {
              //sublayer 2 key 1
              ${createKeyKeycode('layer2', 'sub', 'key1')}
            } else {
              //mainlayer 2 key 1
              ${createKeyKeycode('layer2', 'main', 'key1')}
            }
            break;
          case 2:
            if(subLayer) {
              //sublayer 2 key 2
              ${createKeyKeycode('layer2', 'sub', 'key2')}
            } else {
              //mainlayer 2 key 2
              ${createKeyKeycode('layer2', 'main', 'key2')}
            }
            break;
          case 3:
            if(subLayer) {
              //sublayer 2 key 3
              ${createKeyKeycode('layer2', 'sub', 'key3')}
            } else {
              //mainlayer 2 key 3
              ${createKeyKeycode('layer2', 'main', 'key3')}
            }
            break;
          case 4:
            if(subLayer) {
              //sublayer 2 key 4
              ${createKeyKeycode('layer2', 'sub', 'key4')}
            } else {
              //mainlayer 2 key 4
              ${createKeyKeycode('layer2', 'main', 'key4')}
            }
            break;
          case 5:
            if(subLayer) {
              //sublayer 2 key 5
              ${createKeyKeycode('layer2', 'sub', 'key5')}
            } else {
              //mainlayer 2 key 5
              ${createKeyKeycode('layer2', 'main', 'key5')}
            }
            break;
          case 6:
            if(subLayer) {
              //sublayer 2 key 6
              ${createKeyKeycode('layer2', 'sub', 'key6')}
            } else {
              //mainlayer 2 key 6
              ${createKeyKeycode('layer2', 'main', 'key6')}
            }
            break;
          case 7:
            if(subLayer) {
              //sublayer 2 key 7
              ${createKeyKeycode('layer2', 'sub', 'key7')}
            } else {
              //mainlayer 2 key 7
              ${createKeyKeycode('layer2', 'main', 'key7')}
            }
            break;
          case 8:
            if(subLayer) {
              //sublayer 2 key 8
              ${createKeyKeycode('layer2', 'sub', 'key8')}
            } else {
              //mainlayer 2 key 8
              ${createKeyKeycode('layer2', 'main', 'key8')}
            }
            break;
          case 9:
            if(subLayer) {
              //sublayer 2 key 9
              ${createKeyKeycode('layer2', 'sub', 'key9')}
            } else {
              //mainlayer 2 key 9
              ${createKeyKeycode('layer2', 'main', 'key9')}
            }
            break;

          default:
            break;
        }
        Keyboard.releaseAll();
      }
      
      if(clickType) {
        switch(clickType) {
          case 1: //single
            if(subLayer) {
              //sublayer 2 single
              ${createKnobKeycode('layer2', 'sub', 'single')}
            } else {
              //mainlayer 2 single
              ${createKnobKeycode('layer2', 'main', 'single')}
            }
            break;
          case 2: //double
            if(subLayer) {
              //sublayer 2 double
              ${createKnobKeycode('layer2', 'sub', 'double')}
            } else {
              //mainlayer 2 double
              ${createKnobKeycode('layer2', 'main', 'double')}
            }
            break;
          case 3: //long
            if(subLayer) {
              //sublayer 2 long
              ${createKnobKeycode('layer2', 'sub', 'long')}
            } else {
              //mainlayer 2 long
              ${createKnobKeycode('layer2', 'main', 'long')}
            }
            break;

          default:
            break;
        }
        clickType = 0;
      }
      if(direction) {
        switch (direction) {
          case 1:     //clockwise
            if(subLayer) {
              //sublayer 2 cw
              ${createKnobKeycode('layer2', 'sub', 'clkwise')}
            } else {
              //mainlayer 2 cw
              ${createKnobKeycode('layer2', 'main', 'clkwise')}
            }
            break;
          case 2:     //anti-clockwise
            if(subLayer) {
              //sublayer 2 ccw
              ${createKnobKeycode('layer2', 'sub', 'antiClk')}
            } else {
              //mainlayer 2 ccw
              ${createKnobKeycode('layer2', 'main', 'antiClk')}
            }
            break;

          default:
            break;
        }
      }
      Keyboard.releaseAll(); 
      break;

    //layer 3
    case 3:
      if(key){
        switch (key) {
          case 1:
            if(subLayer) {
              //sublayer 3 key 1
              ${createKeyKeycode('layer3', 'sub', 'key1')}
            } else {
              //mainlayer 3 key 1
              ${createKeyKeycode('layer3', 'main', 'key1')}
            }
            break;
          case 2:
            if(subLayer) {
              //sublayer 3 key 2
              ${createKeyKeycode('layer3', 'sub', 'key2')}
            } else {
              //mainlayer 3 key 2
              ${createKeyKeycode('layer3', 'main', 'key2')}
            }
            break;
          case 3:
            if(subLayer) {
              //sublayer 3 key 3
              ${createKeyKeycode('layer3', 'sub', 'key3')}
            } else {
              //mainlayer 3 key 3
              ${createKeyKeycode('layer3', 'main', 'key3')}
            }
            break;
          case 4:
            if(subLayer) {
              //sublayer 3 key 4
              ${createKeyKeycode('layer3', 'sub', 'key4')}
            } else {
              //mainlayer 3 key 4
              ${createKeyKeycode('layer3', 'main', 'key4')}
            }
            break;
          case 5:
            if(subLayer) {
              //sublayer 3 key 5
              ${createKeyKeycode('layer3', 'sub', 'key5')}
            } else {
              //mainlayer 3 key 5
              ${createKeyKeycode('layer3', 'main', 'key5')}
            }
            break;
          case 6:
            if(subLayer) {
              //sublayer 3 key 6
              ${createKeyKeycode('layer3', 'sub', 'key6')}
            } else {
              //mainlayer 3 key 6
              ${createKeyKeycode('layer3', 'main', 'key6')}
            }
            break;
          case 7:
            if(subLayer) {
              //sublayer 3 key 7
              ${createKeyKeycode('layer3', 'sub', 'key7')}
            } else {
              //mainlayer 3 key 7
              ${createKeyKeycode('layer3', 'main', 'key7')}
            }
            break;
          case 8:
            if(subLayer) {
              //sublayer 3 key 8
              ${createKeyKeycode('layer3', 'sub', 'key8')}
            } else {
              //mainlayer 3 key 8
              ${createKeyKeycode('layer3', 'main', 'key8')}
            }
            break;
          case 9:
            if(subLayer) {
              //sublayer 3 key 9
              ${createKeyKeycode('layer3', 'sub', 'key9')}
            } else {
              //mainlayer 3 key 9
              ${createKeyKeycode('layer3', 'main', 'key9')}
            }
            break;

          default:
            break;
        }
        Keyboard.releaseAll();
      }
      
      if(clickType) {
        switch(clickType) {
          case 1: //single
            if(subLayer) {
              //sublayer 3 single
              ${createKnobKeycode('layer3', 'sub', 'single')}
            } else {
              //mainlayer 3 single
              ${createKnobKeycode('layer3', 'main', 'single')}
            }
            break;
          case 2: //double
            if(subLayer) {
              //sublayer 3 double
              ${createKnobKeycode('layer3', 'sub', 'double')}
            } else {
              //mainlayer 3 double
              ${createKnobKeycode('layer3', 'main', 'double')}
            }
            break;
          case 3: //long
            if(subLayer) {
              //sublayer 3 long
              ${createKnobKeycode('layer3', 'sub', 'long')}
            } else {
              //mainlayer 3 long
              ${createKnobKeycode('layer3', 'main', 'long')}
            }
            break;

          default:
            break;
        }
        clickType = 0;
      }
      if(direction) {
        switch (direction) {
          case 1:     //clockwise
            if(subLayer) {
              //sublayer 3 cw
              ${createKnobKeycode('layer3', 'sub', 'clkwise')}
            } else {
              //mainlayer 3 cw
              ${createKnobKeycode('layer3', 'main', 'clkwise')}
            }
            break;
          case 2:     //anti-clockwise
            if(subLayer) {
              //sublayer 3 ccw
              ${createKnobKeycode('layer3', 'sub', 'antiClk')}
            } else {
              //mainlayer 3 ccw
              ${createKnobKeycode('layer3', 'main', 'antiClk')}
            }
            break;

          default:
            break;
        }
      }
      Keyboard.releaseAll();  
      break;

    default:
      break;
  }

  if(idleStart) idleTime = millis(), idleStart = false;
  if(noInput && millis() - idleTime > timeout && timeoutEnabled) {
    idle = true;
    if(rainbow) {
      static long j = 0;
      if(j<65536) {
        strip.clear();
        strip.setBrightness(30);
        strip.setPixelColor(0, strip.gamma32(strip.ColorHSV(j + (2-0) * 3000)));
        strip.setPixelColor(1, strip.gamma32(strip.ColorHSV(j + (2-1) * 3000)));
        strip.setPixelColor(2, strip.gamma32(strip.ColorHSV(j + (2-2) * 3000)));
        strip.show();
        j+=256;
        delay(10);
      } else {
        j = 0;
      }
    } else {
      strip.setBrightness(1);
    }
  }

  strip.show();
}

///custom functions
uint8_t getClick() {
  uint8_t clickType = 0;
  static const int longPressTiming = 500;
  static const int doubleClickTiming = 300;
  static uint8_t clickState = HIGH;
  static uint8_t prevClickState = HIGH;
  static uint8_t clickCount = 0;
  static unsigned long lastPress;
  static unsigned int clickTime;
  static unsigned int prevClickTime;
  static unsigned int pressFreq = 0;
  static unsigned int timeElapsed;
  static const uint8_t clickDebounce = 20;

  clickState = digitalRead(encoderBtn);
  if(clickState == LOW) {
    if((millis() - lastPress) > clickDebounce) {
      lastPress = millis();
      if(prevClickState == HIGH) {
        clickTime = millis();
        if(clickCount) {
          pressFreq = clickTime - prevClickTime;
        }
        prevClickTime = clickTime;
        clickCount++;
        }
      prevClickState = clickState;
    }
  } else {
    prevClickState = clickState;
  }

  timeElapsed = millis() - clickTime;

  if(clickCount==1 && timeElapsed < longPressTiming && timeElapsed >= doubleClickTiming && prevClickState) {
    clickCount = 0;
    clickType = 1;
  } else if(clickCount==2 && pressFreq < doubleClickTiming && prevClickState) {
    clickCount = 0;
    clickType = 2;
  } else if(clickCount==1 && timeElapsed >= longPressTiming && prevClickState) {
    clickCount = 0;
    clickType = 3;
  }
  return clickType;
}

int getKey() {
  static uint8_t lastKey;
  static uint8_t prevKeyStates[] = {1, 1, 1, 1, 1, 1, 1, 1, 1};
  static uint16_t keyHoldBuffer = 0;
  static uint16_t bufferThreshold = 1300;
  static uint16_t repeatBuffer = 0;
  static uint16_t repeatThreshold = 80;
  int currKey = 0;

  for(byte r=0; r<rowNum; r++) {
    pinMode(rowPins[r], OUTPUT);
    digitalWrite(rowPins[r], LOW);
    for(byte c=0; c<colNum; c++) {
      if(digitalRead(colPins[c]) == 0) {
        if(prevKeyStates[c+colNum*r] == 1) {
          prevKeyStates[c+colNum*r] = 0;
          currKey = c+colNum*r+1;
          lastKey = currKey;
          keyHoldBuffer = 0;
          delay(10);
        }
        if(c+colNum*r+1 == lastKey) {
          if(keyHoldBuffer >= bufferThreshold) {
            if(repeatBuffer >= repeatThreshold) currKey = c+colNum*r+1, repeatBuffer = 0;
            else repeatBuffer++;
          } else {
            keyHoldBuffer++;
          }
        }
      } else {
        prevKeyStates[c+colNum*r] = 1;
      }
    }
    digitalWrite(rowPins[r], HIGH);
    pinMode(rowPins[r], INPUT);
  }
  return(currKey);
}

uint8_t tableDecode() {
  static uint8_t prevStates = 0;
  static uint8_t validation = 0;
  static int8_t encoderLUT[] = {0,1,-1,0,-1,0,0,1,1,0,0,-1,0,-1,1,0};
  static int8_t counterTest =  0;

  prevStates <<= 2;
  if(digitalRead(outputA)) prevStates |= 0x01;
  if(digitalRead(outputB)) prevStates |= 0x02;
  prevStates &= 0xf;

  int8_t decodedVal = encoderLUT[prevStates];
  if(decodedVal) {
    validation <<= 4;
    validation |= prevStates;
    if(validation==23) {
      Serial.print("CW  | ");
      Serial.print("counter: ");
      Serial.println(counterTest);
      counterTest++;
      return 1;
    } else if(validation==43) {
      Serial.print("CCW | ");
      Serial.print("counter: ");
      Serial.println(counterTest);
      counterTest--;
      return 2;
    }
  }
  return 0;
}

void layerChange(byte sign) {
  switch(sign) {
    case 0:
      if(layer < 3) {
        layer++;
      } else {
        layer = 0;
      }
      break;
    case 1:
      if(layer == 0) {
        layer = 3;
      } else {
        layer--;
      }
      break;
    
    default:
      break;
  }
}

void checkBit(byte layer, byte bit, byte led, uint32_t rgb) {
  switch(layer) {
    case 0:
      break;
    case 1:
      if(bit==0) {
        strip.setPixelColor(led, rgb);
      }
      break;
    case 2:
      if(bit==1) {
        strip.setPixelColor(led, rgb);
      }
      break;
    case 3:
      strip.setPixelColor(led, rgb);
      break;
    
    default:
      break;
  }
}`
    );
}